<div style="font-size: 18px; width: auto; max-width: 70vw; min-width: 70vw; min-height: 40vh; max-height: 80vh; height: auto;">
  <a (click)="dialogRef.close()" class="close"></a>
  <h1 class="mat-primary" style="color: #18BC9C; margin-top: 0px;" mat-dialog-title>Siege report</h1>

	<div class="report-container container-fluid">

		<div class="row">

			<div class="col-xs-12 conquests-container" style="padding: 0 !important; width: 100% !important;">

				<div class="conquest-item" style="font-size: 20px !important; max-width: 100% !important;">
					<div class="conquest-contents" style="max-width: 100% !important;">
						<div class="col-xs-12 text-center conquest-title">
							<strong>
								<a routerLink="/indexer/town/{{key}}/{{world}}/{{conquest?.town_id}}">
									<img src="../../assets/images/town_ico.png"/>&nbsp;{{conquest.town_name}}
								</a>
								<span *ngIf="conquest.player_name!='' || conquest.alliance_name!=''">(</span>
								<span *ngIf="conquest.player_name!=''"><a routerLink="/indexer/player/{{key}}/{{world}}/{{conquest?.player_id}}">
											        <img src="../../assets/images/player_ico.png"/>&nbsp;{{conquest.player_name}}
										        </a></span>
								<span *ngIf="conquest.alliance_name!=''"><span *ngIf="conquest.player_name!=''">, </span>
											        <a routerLink="/indexer/alliance/{{key}}/{{world}}/{{conquest?.alliance_id}}">
											        <img src="../../assets/images/ally_ico.png"/>&nbsp;{{conquest.alliance_name}}
										        </a></span>
								<span *ngIf="conquest.player_name!='' || conquest.alliance_name!=''">)</span>
							</strong>
						</div>
						<div class="col-xs-12 conquest-belligerents">
							<div class="row">
								<div class="col-xs-12 text-center" style="position: absolute;">
									<div>{{conquest.last_attack_date | Datex : "D MMM YYYY"}}</div>
									<mat-icon style="font-weight: 900;">âš”</mat-icon>
									<div>
										<strong>Result:&nbsp;</strong>
										<span *ngIf="conquest.cs_killed">siege broken by attackers</span>
										<span *ngIf="!conquest.cs_killed && !conquest.new_owner_player_id">unresolved</span>
										<span *ngIf="!conquest.cs_killed && conquest.new_owner_player_id">Successful conquest by defenders</span>
									</div>
								</div>
								<div class="col-xs-6 text-left left att" style="max-height: 15vh; overflow-y: auto; direction: rtl;">
									Attacking
									<div *ngFor="let bell of conquest.belligerent_all" style="direction: ltr;">
										<a routerLink="/indexer/alliance/{{key}}/{{world}}/{{bell.alliance_id}}">
											<img src="../../assets/images/ally_ico.png"/>&nbsp;{{bell.alliance_name}}
										</a>
									</div>
								</div>
								<div class="col-xs-6 text-right right def" style="max-height: 15vh; overflow-y: auto;">
									Siege lead by
									<div *ngIf="conquest.belligerent_player_name != ''">
										<a routerLink="/player" [queryParams]="{world: world, id: conquest.belligerent_player_id}">
											{{conquest.belligerent_player_name}}&nbsp;<img src="../../assets/images/player_ico.png"/>
										</a>
									</div>
									<div *ngIf="conquest.belligerent_alliance_name != ''">
										<a routerLink="/alliance" [queryParams]="{world: world, id: conquest.belligerent_alliance_id}">
											{{conquest.belligerent_alliance_name}}&nbsp;<img src="../../assets/images/ally_ico.png"/>
										</a>
									</div>
								</div>
							</div>
						</div>
						<div class="col-xs-12 conquest-losses">
							<div class="row">
								<div class="col-xs-6 text-left left att">
									<strong>Attacker losses</strong> ({{conquest.num_attacks_counted}} attacks)
									<div class="unit-row">
										<div class="unit-icon-lg" *ngFor="let unit of objectKeys(conquest.total_losses_att)" title="{{unit}}">
											<div class="unit_icon40x40 {{unit}}"><span class="unit-val">{{conquest.total_losses_att[unit]}}</span></div>
										</div>
									</div>
								</div>
								<div class="col-xs-6 text-right right def">
									<strong>Defender losses</strong><br/>
									<div class="unit-row" style="float: right;">
						        <span *ngFor="let unit of objectKeys(conquest.total_losses_def)">
							        <div class="unit-icon-lg" *ngIf="conquest.total_losses_def[unit] > 20 || conquest.total_losses_def.length <= 5 || unit=='colonize_ship'" title="{{unit}}">
								        <div class="unit_icon40x40 {{unit}}"><span class="unit-val">{{conquest.total_losses_def[unit]}}</span></div>
							        </div>
						        </span>
									</div>
								</div>
							</div>
						</div>

						<div class="col-xs-12 conquest-reports">

							<div class="col-xs=12 text-center" *ngIf="loading">
								<mat-progress-bar mode="indeterminate"></mat-progress-bar>
								<strong>Loading battle report..</strong>
							</div>

							<div class="col-xs-12" *ngIf="!loading && error">
								<h2>Sorry, we can not load the report for this conquest at the moment. try again later.</h2>
							</div>


							<div class="col-xs-12" *ngIf="!loading && !error" style="padding: 0 !important;">

								<div style="max-height: 50vh; overflow-y: auto;">
									<div class="table" id="table_players_rows">
										<div class='row_custom' *ngFor="let report of reports">
											<div class="cell text-right" style="width: 10%; height: 90px;">
												{{report.date | Datex : "D MMM YYYY"}}
												<br/>
												{{report.date | Datex : "HH:mm"}}
											</div>
											<div class="cell text-right" style="width: 20%; height: 90px;">
												<a routerLink="/indexer/town/{{key}}/{{world}}/{{report?.attacker?.town_id}}" style="display: block;">
													{{report?.attacker?.town_name}}&nbsp;<img src="../../assets/images/town_ico.png"/>
												</a>
												<span *ngIf="report?.attacker?.player_name!=''">
													<a routerLink="/indexer/player/{{key}}/{{world}}/{{report?.attacker?.player_id}}" style="display: block;">
									        {{report?.attacker?.player_name}}&nbsp;<img src="../../assets/images/player_ico.png"/>
								        </a></span>
																<span *ngIf="report?.attacker?.alliance_id!=0 && allianceNames[report?.attacker?.alliance_id]">
									        <a routerLink="/indexer/alliance/{{key}}/{{world}}/{{report?.attacker?.alliance_id}}" style="display: block;">
									        {{allianceNames[report?.attacker?.alliance_id]}}&nbsp;<img src="../../assets/images/ally_ico.png"/>
								        </a></span>
											</div>
											<div class="cell" style="width: 15%; height: 90px;">
												<div class="unit-row" style="float: left;    margin-top: -30px;">
									        <span *ngFor="let unit of objectKeys(report?.attacker?.units)">
										        <div class="unit-icon-lg" title="{{unit}}">
											        <div class="unit_icon40x40 {{unit}}">
												        <span class="unit-val"><span [outerHTML]="report?.attacker?.units[unit] | HideNoLossPipe : true"></span></span>
											        </div>
										        </div>
									        </span>
												</div>
											</div>
											<div class="cell" style="width: 55%; height: 90px;">
												<div style="">
													<div class="unit-row" style="float: right; margin-top: -30px;">
										        <span *ngFor="let unit of objectKeys(report?.defender?.units?.sea)">
											        <div class="unit-icon-lg" title="{{unit}}">
												        <div class="unit_icon40x40 {{unit}}">
													        <span class="unit-val"><span [outerHTML]="report?.defender?.units?.sea[unit] | HideNoLossPipe : true"></span></span>
												        </div>
											        </div>
										        </span>
													</div>
													<div class="unit-row" style="float: right;    margin-top: -30px;">
										        <span *ngFor="let unit of objectKeys(report?.defender?.units?.land)">
											        <div class="unit-icon-lg" title="{{unit}}">
												        <div class="unit_icon40x40 {{unit}}">
													        <span class="unit-val"><span [outerHTML]="report?.defender?.units?.land[unit] | HideNoLossPipe : true"></span></span>
												        </div>
											        </div>
										        </span>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>



		</div>

	</div>

</div>
